# Maintainer: Franco Masotti <franco dot masotti at student dot unife dot it>
pkgname=swish-cplint
pkgver=r1628.92c3f2c
pkgrel=1
pkgdesc="SWI-Prolog for SHaring: a SWI-Prolog web IDE integrated with the cplint suite"
arch=('x86_64')
url="git://github.com/friguzzi/swish"
license=('BSD')
depends=('swi-prolog', 'r')
makedepends=('git', 'bower')
conflicts=('swish')
install=.INSTALL
source=('git://github.com/friguzzi/swish#branch=master')
md5sums=('SKIP')

build() {
	cd ${srcdir}/${pkgname}
    bower --allow-root install
    make src
    # Cplint stuff is installed separately.
    ../install_web_iface_deps.pl
}

pkgver () {
	cd ${srcdir}/${pkgname}
    ( set -o pipefail
      git describe --long 2>/dev/null | sed 's/\([^-]*-g\)/r\1/;s/-/./g' ||
      printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
    )
}

package() {
	cd ${srcdir}
    install -d ${pkgdir}/usr/share/${pkgname}
    install -Dm755 ${pkgname} ${pkgdir}/usr/share/${pkgname}
    install -D -m644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    ln -s /usr/share/${pkgname}/run.sh ${pkgdir}/usr/bin/${pkgname}
}
